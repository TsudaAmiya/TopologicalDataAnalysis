# 最尤法

## ざっくりいうと
- 最尤法は、確率によって生じる現象の有限回の実験結果があったとき、その現象の確率分布は何であったかを推定する方法。
- 数学的にはめっちゃ簡単で、尤度関数と呼ばれる関数の最大化問題。
  - $\Theta$ を確率分布全体の部分集合として、$\Omega$を実験のとりうる値の集合、$x=(x_{1},\ldots, x_{n})$を有限回の実験結果としたとき、$L: \Theta \times \Omega^{n} \to \R$を定義して、$x$を固定したときに$L$が最大となる$\Theta$の元を特定しようというもの。

## 定義

> **定義（最尤法）**
>
> $(\Omega, \mathcal{F}, \mu)$ を測度空間とする。
>
> $\Theta$ をパラメータ空間とし、各 $\theta \in \Theta$ に対して $p_\theta : \Omega \to [0,\infty)$ は可測関数であり、
>
> $$
> \int_{\Omega} p_\theta(x) \, d\mu(x) = 1
> $$
>
> を満たすものとする。(※つまり、$p_\theta$ によって定まる確率測度 $\mathbb{P}_\theta(A) := \int_A p_\theta(x) d\mu(x)$ を考えている。)
>
> 観測データ $x = (x_1, \dots, x_n) \in \Omega^n$ が得られたとき、**尤度関数** $L : \Theta \times \Omega^n \to [0, \infty)$ を：
>
> $$
> L(\theta; x) := \prod_{i=1}^n p_\theta(x_i)
> $$
>
> により定義する。
>
> そして、$x$ を固定したときにこの関数を最大化する $\theta \in \Theta$ を最尤推定量といい、その一つを$\theta_x$とかく。
>
> このとき、最尤推定は「$x$ を生じさせた真の分布は $(p_\theta)_{\theta \in \Theta}$ のうち何らかである」と仮定し、$x$ に最も尤もらしいパラメータ $\theta_x$ を推定する手法である。

> **定義（対数尤度関数）**
> 
> $\log$が単調増加であるので、$\theta$に対し、$L(\theta; x)$を最大化することと$\log L(\theta; x)$を最大化することは同値なので、そちらが計算が楽な場合はそちらで行いたい。
> $$
> l(\theta; x) := \log L(\theta; x)
> $$
> を対数尤度関数と呼ぶ。


## 例1 重さに偏りのあるコイン
> **現実の問題設定**
>
> 重さに偏りがあり、表が出る確率が $\theta \in [0,1]$の謎のコインがあるとする。
> 
> $10$回振ってみて結果が(表, 表, 表, 表, 表, 表, 表, 表, 裏, 裏)であった。
> 
> $\theta$はなんだったとするのが最も尤もらしい？

↓

> **数学の問題設定**
>
> $\Omega = \{0,1\}$, 
> 
> $\mathcal{F} = \{\emptyset, \{0\}, \{1\}, \{0,1\}\}$, 
> 
> $\mu(A) = \frac{1}{2} \cdot |A|$ （$|A|$ は集合 $A$ の要素数）
>
> $\Theta = [0,1]$
>
> $$
>p_\theta(x) :=
>\begin{cases}
>\theta & \text{if } x = 1 \\
>1 - \theta & \text{if } x = 0
>\end{cases}
>$$
>
> $x = (1,1,1,1,1,1,1,1,0,0)$
>
> この状況下で最尤推定を行え。


$$
L(\theta; x) := \prod_{i=1}^{10} p_\theta(x_i)
= \prod_{i=1}^{10} \theta^{x_i} (1 - \theta)^{1 - x_i}
$$

ここで、$x_i = 1$ が8回、$x_i = 0$ が2回なので、

$$
L(\theta; x) = \theta^8 (1 - \theta)^2
$$

である。ふつうに微分して増減表を書けば、$\theta = \frac{8}{10}$で最大となることがわかる。


---

## 例2 正規分布に従うデータ（平均・分散とも未知）

> **現実の問題設定**
>
> 身長のような連続的な量が正規分布に従うと仮定する。
> ある集団からランダムに5人を選んだところ、身長は次の通りであった：
> $170, 172, 168, 171, 169$（単位 cm）。
>
> この観測データを最もよく説明する正規分布の平均 $\mu$ および分散 $\sigma^2$ を推定せよ。

↓

> **数学の問題設定**
>
> 測度空間 $(\Omega, \mathcal{F}, \mu)$ を：
>
> $\Omega = \mathbb{R}$ 
> 
> $\mathcal{F}$：ルベーグ可測集合
> 
> $\mu$：ルベーグ測度
>
> パラメータ空間：$\Theta = \{ (\mu, \sigma) \in \mathbb{R} \times (0, \infty) \}$
>
> 各 $\theta = (\mu, \sigma)$ に対し、確率密度関数 $p_{\mu, \sigma}$ は：
>
> $$
> p_{\mu, \sigma}(x) := \frac{1}{\sqrt{2\pi \sigma^2}} \exp\left( -\frac{(x - \mu)^2}{2\sigma^2} \right)
> $$
>
> 観測データ：
>
> $$
> x = (170, 172, 168, 171, 169)
> $$
>
> このとき、最尤推定を行え。

---

### 尤度関数

観測データ $x = (x_1, \dots, x_5)$ に対して：

$$
L(\mu, \sigma; x) = \prod_{i=1}^5 \frac{1}{\sqrt{2\pi \sigma^2}} \exp\left( -\frac{(x_i - \mu)^2}{2\sigma^2} \right)
= \left( \frac{1}{\sqrt{2\pi \sigma^2}} \right)^5 \exp\left( -\frac{1}{2\sigma^2} \sum_{i=1}^5 (x_i - \mu)^2 \right)
$$

---

### 対数尤度関数

$$
l(\mu, \sigma; x) := \log L(\mu, \sigma; x) = -\frac{5}{2} \log(2\pi \sigma^2) - \frac{1}{2\sigma^2} \sum_{i=1}^5 (x_i - \mu)^2
$$


---

### Step 1: $\mu$ で偏微分して、最適条件を求める

まず、$\sigma$を固定して、$l(\mu, \sigma; x)$ を$\mu$で偏微分する。

$$
\frac{\partial l}{\partial \mu}
= -\frac{1}{2\sigma^2} \cdot 2 \sum_{i=1}^5 (x_i - \mu)(-1)
= \frac{1}{\sigma^2} \sum_{i=1}^5 (x_i - \mu)
$$

これが0になるとき、

$$
\sum_{i=1}^5 (x_i - \mu) = 0
\quad \Rightarrow \quad
5\mu = \sum_{i=1}^5 x_i \quad \Rightarrow \quad \mu = \frac{1}{5} \sum_{i=1}^5 x_i
$$

よって、最尤推定量 $\hat{\mu}$ は標本平均：

$$
\hat{\mu} = \bar{x} = \frac{170 + 172 + 168 + 171 + 169}{5} = \frac{850}{5} = 170
$$

---

### Step 2: $\sigma$ で偏微分して、最適条件を求める

$\mu = \hat{\mu}$ を代入して、$l$ を$\sigma$で偏微分する。

$$
\frac{\partial l}{\partial \sigma}
= -\frac{5}{\sigma} + \frac{1}{\sigma^3} \sum_{i=1}^5 (x_i - \hat{\mu})^2
$$

これを0とおくと、

$$
-\frac{5}{\sigma} + \frac{1}{\sigma^3} \sum_{i=1}^5 (x_i - \hat{\mu})^2 = 0
\quad \Rightarrow \quad
\frac{1}{\sigma^3} \sum_{i=1}^5 (x_i - \hat{\mu})^2 = \frac{5}{\sigma}
$$

両辺に$\sigma^3$をかけると、

$$
\sum_{i=1}^5 (x_i - \hat{\mu})^2 = 5\sigma^2
\quad \Rightarrow \quad
\hat{\sigma}^2 = \frac{1}{5} \sum_{i=1}^5 (x_i - \hat{\mu})^2
$$

---

### Step 3: 実際に数値を代入して計算

$\hat{\mu} = 170$ に対して：

$$
\begin{align*}
(x_i - \hat{\mu})^2 &= (170 - 170)^2 + (172 - 170)^2 + (168 - 170)^2 + (171 - 170)^2 + (169 - 170)^2 \\
&= 0^2 + 2^2 + (-2)^2 + 1^2 + (-1)^2 \\
&= 0 + 4 + 4 + 1 + 1 = 10
\end{align*}
$$

よって：

$$
\hat{\sigma}^2 = \frac{10}{5} = 2 \quad \Rightarrow \quad \hat{\sigma} = \sqrt{2}
$$

---

## **結論：最尤推定量**

* 平均の最尤推定値：

  $$
  \hat{\mu} = 170
  $$

* 分散の最尤推定値：

  $$
  \hat{\sigma}^2 = 2, \quad \hat{\sigma} = \sqrt{2}
  $$

この正規分布 $N(170, 2)$ が、与えられた観測データに対して最も尤もらしいモデル（＝最尤推定）になる。

---

## 例3 生物学における系統樹構築への最尤法の適用

### **系統樹の基本用語と定義**

系統樹解析で用いられる重要な概念を以下に定義する：

> **定義（系統樹の基本用語）**
>
> - **種数（$k$）**: 解析対象となる生物種の数。本例では$k=5$（内群S, T, U, V + 外群O）
>
> - **内群（ingroup）**: 系統関係を推定したい対象種の集合。本例では$\{S, T, U, V\}$（4種）
>
> - **外群（outgroup）**: 内群よりも進化的に古い分岐点で分かれた種。本例では$O$（1種）
>   - 外群は内群の最も近い共通祖先よりも古い時点で分岐した種
>   - 系統樹に根を設定するために用いられる
>
> - **系統樹トポロジー（$T$）**: 種間の分岐関係を表す木構造。枝長の情報は含まない純粋な分岐パターン
>   - 無根系統樹の例：$((S,T),(U,(V,O)))$ 
>   - 有根系統樹の例：$((((S,T),U),V),O)$ 有根系統樹は、外群と最後に分岐する系統樹としてあらわすことができる。
>
> - **有根系統樹**: 外群を用いて根（最古の共通祖先）の位置が決定された系統樹
>   - 進化の時間的方向が明確
>   - 祖先的形質と派生的形質を区別可能
>   - $k$種(内群4種+外群1種)の可能な分岐パターン数：$(2*k-5)!!$
>
> - **枝数**: 有根系統樹の枝の総数は$2k-2$本
>   - $k=5$の場合：$2 \times 5 - 2 = 8$本の枝
>   - 内部枝：$k-2 = 3$本（種間の系統関係を表す）
>   - 外部枝：$k = 5$本（現生種に至る枝）
>
> **※$k=5$の場合の全系統樹トポロジーパターン**
>
> 外群O（1種）と内群S, T, U, V（4種）の場合、可能な有根系統樹トポロジーは**15通り**である：
>
> **グループ1: ((S,T),(U,V))型（3通り）**
> ```
> パターン1-1: ((((S,T),(U,V)),),O) = (((S,T),(U,V)),O)
>                            N4
>                  ┌─────────┴───────┐
>                  │                 │
>                 N3                 O (外群)
>                  │
>            ┌─────┴─────┐
>            │           │
>           N1          N2
>            │           │
>        ┌───┴───┐   ┌───┴───┐
>        │       │   │       │
>        S       T   U       V
>
> パターン1-2: ((((S,U),(T,V)),),O) = (((S,U),(T,V)),O)
> パターン1-3: ((((S,V),(T,U)),),O) = (((S,V),(T,U)),O)
> ```
>
> **グループ2: (((S,T),U),V)型（12通り）**
> ```
> パターン2-1: ((((S,T),U),V),O)
>                           N4
>                  ┌────────┴────────┐
>                  │                 │
>                 N3                 O (外群)  
>                  │
>            ┌─────┴─────┐
>            │           │
>           N2           V
>            │
>        ┌───┴───┐
>        │       │
>       N1       U
>        │
>     ┌──┴──┐
>     │     │
>     S     T
>
> パターン2-2: ((((S,T),V),U),O)
> パターン2-3: ((((S,U),T),V),O)
> パターン2-4: ((((S,U),V),T),O)
> パターン2-5: ((((S,V),T),U),O)
> パターン2-6: ((((S,V),U),T),O)
> パターン2-7: ((((T,U),S),V),O)
> パターン2-8: ((((T,U),V),S),O)
> パターン2-9: ((((T,V),S),U),O)
> パターン2-10: ((((T,V),U),S),O)
> パターン2-11: ((((U,V),S),T),O)
> パターン2-12: ((((U,V),T),S),O)
> ```



> **定義（系統樹パラメータ空間）**
>
> 外群を用いた有根系統樹推定のパラメータ空間は以下で定義される：
> $$
> \Theta = \{\text{有根系統樹トポロジー集合}\} \times \mathbb{R}_{>0}^{2k-2}
> $$
> 
> 各パラメータ$\theta = (T_{\text{rooted}}, \mathbf{t})$は：
> - $T_{\text{rooted}}$：特定の有根系統樹トポロジー（外群により根が決定）
> - $\mathbf{t}$：そのトポロジーにおける枝長ベクトル（長さ$2k-2$）
>
> **※外群による制約**：
> - 外群の位置は固定されているため、内群内の分岐順序のみが推定対象
> - 内群$n$種の場合、可能な有根トポロジー数は$(2n-3)!!$
> - 本例では内群4種なので、$5!! = 15$通りの有根トポロジーを比較

### **問題設定**

> **現実の問題設定**
>
> 4つの内群（ingroup）S, T, U, V と1つの外群（outgroup）O のDNA配列データが得られている。
> 各種について同じ遺伝子領域の配列（例：4塩基対）を決定した：
> - 種S: ATGC（内群）
> - 種T: ATCC（内群）  
> - 種U: GTCC（内群）
> - 種V: GTGC（内群）
> - 種O: GGAA（外群：進化的に最も遠い種）
>
> 外群Oを用いて系統樹に根（root）を設定し、内群S, T, U, Vの進化的関係（有根系統樹）を最尤法で推定したい。

↓

> **数学の問題設定**
>
> 測度空間 $(\Omega, \mathcal{F}, \mu)$ を：
>
> $\Omega = \{A, T, G, C\}$ （塩基の集合）
> 
> $\mathcal{F} = 2^{\Omega}$ （$\Omega$ の冪集合）
> 
> $\mu(\{x\}) = \frac{1}{4}$ for all $x \in \Omega$ （各塩基の測度は等しく $\frac{1}{4}$）
>
> パラメータ空間：$\Theta = \{\text{有根系統樹トポロジー} \times \mathbb{R}_{>0}^{2k-2}\}$
>
> ここで $k=5$ は総種数（内群4種+外群1種）、$2k-2=8$ は有根系統樹の枝数
>
> 各パラメータ $\theta = (T_{\text{rooted}}, \mathbf{t}) \in \Theta$ に対して（$T_{\text{rooted}}$ は有根トポロジー、$\mathbf{t}$ は枝長ベクトル）、
> 
> Jukes-Cantorモデルによる置換確率密度 $p_\theta : (\Omega^{5})^{4} \to [0,\infty)$ を定義：
>
> $$
> p_\theta(\mathbf{d}) = \prod_{i=1}^{4} \sum_{x} \pi_x L_i(x; T_{\text{rooted}}, \mathbf{t})
> $$
>
> ここで：
> - $\mathbf{d} = (\mathbf{d}_1, \mathbf{d}_2, \mathbf{d}_3, \mathbf{d}_4) \in (\Omega^{5})^{4}$ （各サイトでの5種の塩基データ）
> - $\mathbf{d}_i = (d_{i,S}, d_{i,T}, d_{i,U}, d_{i,V}, d_{i,O}) \in \Omega^5$ （サイト $i$ での観測塩基、Oは外群）
> - $\pi_x = \frac{1}{4}$ （塩基 $x$ の平衡頻度）
> - $L_i(x; T_{\text{rooted}}, \mathbf{t})$ はサイト $i$ における Felsenstein アルゴリズムによる条件付き尤度
>
> 観測データ：
>
> $$
> \mathbf{d} = ((A,A,G,G,G), (T,T,T,T,G), (G,C,C,G,A), (C,C,C,C,A))
> $$
>
>
> **※データの整理方法について**
>
> 元の配列データ：
> - 種S: ATGC（内群）
> - 種T: ATCC（内群）  
> - 種U: GTCC（内群）
> - 種V: GTGC（内群）
> - 種O: GGAA（外群）
>
> これをサイト別（位置別）に整理すると：
> - サイト1（1番目の塩基）：A, A, G, G, G （種S, T, U, V, Oの順）
> - サイト2（2番目の塩基）：T, T, T, T, G （種S, T, U, V, Oの順）
> - サイト3（3番目の塩基）：G, C, C, G, A （種S, T, U, V, Oの順）
> - サイト4（4番目の塩基）：C, C, C, C, A （種S, T, U, V, Oの順）
>
> 外群Oは内群S, T, U, Vよりも進化的に遠い種として扱い、これにより有根系統樹を構築する。
>
> この状況下で最尤推定を行え。

---



### **数学的定式化の詳細**

最も単純な置換モデルとして、すべての塩基間の置換率が等しいと仮定する：

ここで $m$ は置換率パラメータ。

時間 $t$ 後の置換確率行列を：

$$
P(t) = \frac{1}{4} \begin{pmatrix}
1+3e^{-m t} & 1-e^{-m t} & 1-e^{-m t} & 1-e^{-m t} \\
1-e^{-m t} & 1+3e^{-m t} & 1-e^{-m t} & 1-e^{-m t} \\
1-e^{-m t} & 1-e^{-m t} & 1+3e^{-m t} & 1-e^{-m t} \\
1-e^{-m t} & 1-e^{-m t} & 1-e^{-m t} & 1+3e^{-m t}
\end{pmatrix}
$$
と定義する。

#### **3. 尤度関数の定義**






### 具体的な尤度計算例

**トポロジー**: `(((S,T),(U,V)),O)`

```
                    N4 (root)
          ┌─────────┴───────┐
          │                 │
         N3                 O (外群)
          │
    ┌─────┴─────┐
    │           │
   N1          N2
    │           │
┌───┴───┐   ┌───┴───┐
│       │   │       │
S       T   U       V
```

### 枝長（固定値）

以下の枝長を固定して計算する：

> S-N1 = 0.1
> 
> T-N1 = 0.1
>
> U-N2 = 0.1
>
> V-N2 = 0.1
>
> N1-N3 = 0.2
>
> N2-N3 = 0.2
>
> N3-N4 = 0.3
>
> O-N4 = 0.8

### サイト1の尤度計算

観測データ：**サイト1** = (A, A, G, G, G) （種S, T, U, V, Oの順）

上記のトポロジー、枝長のサイト1での尤度を計算する

Felsenteinアルゴリズムを用いて、葉から根に向かって条件付き尤度を計算する。

#### Step 1: 葉ノードの初期化



>定義
>
>ノード $R$ における塩基 $i \in {A, T, G, C}$ の条件付き尤度 $L_R(i)$ とは：
>
>「ノード $R$ に塩基 $i$ が存在したと仮定したときに、そのノード以下の部分木で観測されるデータが得られる確率」

- 種S（観測：A）: $L_S(j) = \delta_{A,j}$
- 種T（観測：A）: $L_T(j) = \delta_{A,j}$
- 種U（観測：G）: $L_U = \delta_{G,j}$
- 種V（観測：G）: $L_V = \delta_{G,j}$
- 種O（観測：G）: $L_O = \delta_{G,j}$

#### Step 2: 内部ノードN1の計算（S, Tの共通祖先）

枝長 S-N1 = 0.1, T-N1 = 0.1 を用いて置換確率を計算：

$$P(0.1) = \frac{1}{4} \begin{pmatrix}
1+3e^{-0.1m} & 1-e^{-0.1m} & 1-e^{-0.1m} & 1-e^{-0.1m} \\
1-e^{-0.1m} & 1+3e^{-0.1m} & 1-e^{-0.1m} & 1-e^{-0.1m} \\
1-e^{-0.1m} & 1-e^{-0.1m} & 1+3e^{-0.1m} & 1-e^{-0.1m} \\
1-e^{-0.1m} & 1-e^{-0.1m} & 1-e^{-0.1m} & 1+3e^{-0.1m}
\end{pmatrix}$$

$m = 1$とすると、$e^{-0.1} \approx 0.905$：

$$P(0.1) \approx \frac{1}{4} \begin{pmatrix}
3.715 & 0.095 & 0.095 & 0.095 \\
0.095 & 3.715 & 0.095 & 0.095 \\
0.095 & 0.095 & 3.715 & 0.095 \\
0.095 & 0.095 & 0.095 & 3.715
\end{pmatrix}$$

ノードN1での各塩基に対する条件付き尤度：

$$L_{N1}(i) = \left(\sum_{j} P_{ij}(0.1) \cdot L_S(j)\right) \times \left(\sum_{j} P_{ij}(0.1) \cdot L_T(j)\right)$$

- $L_{N1}(A) = P_{AA}(0.1) \times P_{AA}(0.1) = 0.929 \times 0.929 \approx 0.863$
- $L_{N1}(T) = P_{TA}(0.1) \times P_{TA}(0.1) = 0.024 \times 0.024 \approx 0.0006$
- $L_{N1}(G) = P_{GA}(0.1) \times P_{GA}(0.1) = 0.024 \times 0.024 \approx 0.0006$
- $L_{N1}(C) = P_{CA}(0.1) \times P_{CA}(0.1) = 0.024 \times 0.024 \approx 0.0006$

#### Step 3: 内部ノードN2の計算（U, Vの共通祖先）

同様に、枝長 U-N2 = 0.1, V-N2 = 0.1 を用いて：

$$L_{N2}(i) = \left(\sum_{j} P_{ij}(0.1) \cdot L_U(j)\right) \times \left(\sum_{j} P_{ij}(0.1) \cdot L_V(j)\right)$$

- $L_{N2}(A) = P_{AG}(0.1) \times P_{AG}(0.1) = 0.024 \times 0.024 \approx 0.0006$
- $L_{N2}(T) = P_{TG}(0.1) \times P_{TG}(0.1) = 0.024 \times 0.024 \approx 0.0006$
- $L_{N2}(G) = P_{GG}(0.1) \times P_{GG}(0.1) = 0.929 \times 0.929 \approx 0.863$
- $L_{N2}(C) = P_{CG}(0.1) \times P_{CG}(0.1) = 0.024 \times 0.024 \approx 0.0006$

#### Step 4: 内部ノードN3の計算（N1, N2の共通祖先）

枝長 N1-N3 = 0.2, N2-N3 = 0.2 を用いて：

$$P(0.2) \approx \frac{1}{4} \begin{pmatrix}
3.451 & 0.183 & 0.183 & 0.183 \\
0.183 & 3.451 & 0.183 & 0.183 \\
0.183 & 0.183 & 3.451 & 0.183 \\
0.183 & 0.183 & 0.183 & 3.451
\end{pmatrix}$$

$$L_{N3}(i) = \left(\sum_{j} P_{ij}(0.2) \cdot L_{N1}(j)\right) \times \left(\sum_{j} P_{ij}(0.2) \cdot L_{N2}(j)\right)$$

- $L_{N3}(A) = (0.863 \times 0.863 + 0.046 \times 0.0006 + \cdots) \times (0.046 \times 0.0006 + \cdots) \approx 0.746 \times 0.040 \approx 0.030$
- $L_{N3}(G) = (0.046 \times 0.863 + \cdots) \times (0.863 \times 0.863 + \cdots) \approx 0.040 \times 0.746 \approx 0.030$

#### Step 5: 根ノードN4での最終計算

枝長 N3-N4 = 0.3, O-N4 = 0.8 を用いて置換確率行列を計算：

$m = 1$として、$e^{-0.3} \approx 0.741$, $e^{-0.8} \approx 0.449$：

$$P(0.3) \approx \frac{1}{4} \begin{pmatrix}
3.222 & 0.259 & 0.259 & 0.259 \\
0.259 & 3.222 & 0.259 & 0.259 \\
0.259 & 0.259 & 3.222 & 0.259 \\
0.259 & 0.259 & 0.259 & 3.222
\end{pmatrix}$$

$$P(0.8) \approx \frac{1}{4} \begin{pmatrix}
2.347 & 0.551 & 0.551 & 0.551 \\
0.551 & 2.347 & 0.551 & 0.551 \\
0.551 & 0.551 & 2.347 & 0.551 \\
0.551 & 0.551 & 0.551 & 2.347
\end{pmatrix}$$

根ノードN4での各塩基に対する条件付き尤度：

$$L_{N4}(i) = \left(\sum_{j} P_{ij}(0.3) \cdot L_{N3}(j)\right) \times \left(\sum_{j} P_{ij}(0.8) \cdot L_O(j)\right)$$

Step 4より、$L_{N3}(A) \approx 0.030$, $L_{N3}(G) \approx 0.030$, その他は無視できるほど小さいとして：

- $L_{N4}(A) = (P_{AA}(0.3) \times 0.030 + P_{AG}(0.3) \times 0.030) \times P_{AG}(0.8) \times 1$
  $= (0.806 \times 0.030 + 0.065 \times 0.030) \times 0.138 \approx 0.026 \times 0.138 \approx 0.0036$

- $L_{N4}(T) = (P_{TA}(0.3) \times 0.030 + P_{TG}(0.3) \times 0.030) \times P_{TG}(0.8) \times 1$
  $= (0.065 \times 0.030 + 0.065 \times 0.030) \times 0.138 \approx 0.0039 \times 0.138 \approx 0.00054$

- $L_{N4}(G) = (P_{GA}(0.3) \times 0.030 + P_{GG}(0.3) \times 0.030) \times P_{GG}(0.8) \times 1$
  $= (0.065 \times 0.030 + 0.806 \times 0.030) \times 0.587 \approx 0.026 \times 0.587 \approx 0.015$

- $L_{N4}(C) = (P_{CA}(0.3) \times 0.030 + P_{CG}(0.3) \times 0.030) \times P_{CG}(0.8) \times 1$
  $= (0.065 \times 0.030 + 0.065 \times 0.030) \times 0.138 \approx 0.0039 \times 0.138 \approx 0.00054$

#### Step 6: サイト1の最終尤度

サイト1の尤度は、根での各塩基の平衡頻度を重み付けして：

$$L_1 = \sum_{i \in \{A,T,G,C\}} \pi_i \times L_{N4}(i)$$

$$L_1 = \frac{1}{4} \times (0.0036 + 0.00054 + 0.015 + 0.00054) = \frac{1}{4} \times 0.0197 \approx 0.0049$$

### サイト2の尤度計算


### サイト3の尤度計算


### サイト4の尤度計算

### 全体の尤度
$L= \prod L_{i}$
